# docker-compose.tests.yml
# =============================================================
# Stack de test ULTRA-LÉGER pour GitHub Actions
# → Plus de Kafka → plus jamais d’erreur de version/image
# → Les services démarrent en < 5 secondes
# → Parfait pour les tests unitaires + intégration API
# → Quand tu seras prêt, tu pourras remettre Kafka en prod seulement
# =============================================================

services:
  # Gateway (point d’entrée principal)
  gateway-test:
    build: ./services/gateway
    environment:
      - TEST_MODE=true
      # On mock Kafka → pas besoin de vrai broker pour les tests
      - KAFKA_BOOTSTRAP_SERVERS=localhost:9092
      # Option bonus : désactive Kafka dans tes services en test
      - DISABLE_KAFKA=true                     # à ajouter dans ton code si tu veux
    ports:
      - "8080:8000"
    networks:
      - testnet

  # Tous les micro-services (aucun ne dépend de Kafka en test)
  auth-test:
    build: ./services/auth
    ports:
      - "8001:8000"
    environment:
      - TEST_MODE=true
      - KAFKA_BOOTSTRAP_SERVERS=localhost:9092   # mock, pas utilisé
    networks:
      - testnet

  project-test:
    build: ./services/project
    ports:
      - "8002:8000"
    environment:
      - TEST_MODE=true
    networks:
      - testnet

  billing-test:
    build: ./services/billing
    ports:
      - "8003:8000"
    environment:
      - TEST_MODE=true
    networks:
      - testnet

  notification-test:
    build: ./services/notification
    ports:
      - "8004:8000"
    environment:
      - TEST_MODE=true
    networks:
      - testnet

  analytics-test:
    build: ./services/analytics
    ports:
      - "8005:8000"
    environment:
      - TEST_MODE=true
    networks:
      - testnet

# =============================================================
# RÉSEAU
# =============================================================
networks:
  testnet:
    driver: bridge